/*
 */
package vista;

import static extras.Colores_Dimensiones.DIMENSION_EXTRA;
import extras.ModeloAlquiler;
import java.util.ArrayList;
import javax.swing.JButton;
import javax.swing.JOptionPane;
import javax.swing.JTextField;
import javax.swing.table.TableColumnModel;
import modelo.Alquiler;

/**
 *
 * @author Escoz
 */
public class DialogoAlquiler extends javax.swing.JDialog {

    private VistaPrincipal vista_padre;
    private ModeloAlquiler modelo_tabla;
    private ModeloAlquiler modelo_busqueda;

    /**
     * Creates new form DialogoAlquiler
     */
    public DialogoAlquiler(VistaPrincipal padre, boolean modal) {
        super(padre, modal);

        this.vista_padre = padre;
        this.modelo_tabla = new ModeloAlquiler();
        this.modelo_busqueda = new ModeloAlquiler();

        initComponents();
        ajustaTabla();
        setMinimumSize(DIMENSION_EXTRA);
    }

    public void muestraAlquileres(ArrayList<Alquiler> alquileres) {

        ModeloAlquiler modelo = (ModeloAlquiler) tabla_alquileres.getModel();
        tabla_alquileres.getRowSorter().setSortKeys(null);
        modelo.addAlquileres(alquileres);

        boton_limpiarActionPerformed(null);

        panel_busqueda.requestFocus();
        setLocationRelativeTo(vista_padre);
        ajustaTabla();
        setVisible(true);
    }

    private void ajustaTabla() {

        TableColumnModel modelo_columna = tabla_alquileres.getColumnModel();

        modelo_columna.getColumn(1).setMinWidth(150);
        modelo_columna.getColumn(3).setMinWidth(180);

    }

    public void actualizaTabla(ArrayList<Alquiler> alquileres) {
        if (this.isVisible()) {
            ModeloAlquiler modelo = (ModeloAlquiler) tabla_alquileres.getModel();
            tabla_alquileres.getRowSorter().setSortKeys(null);
            modelo.addAlquileres(alquileres);
            ajustaTabla();
        }
    }

    /**
     * This method is called from within the constructor to initialize the form. WARNING: Do NOT modify this code. The
     * content of this method is always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        pop_alquileres = new javax.swing.JPopupMenu();
        popMenu_devolucion = new javax.swing.JMenuItem();
        popMenu_verLibro = new javax.swing.JMenuItem();
        popMenu_verUsuario = new javax.swing.JMenuItem();
        grupo_buscador = new javax.swing.ButtonGroup();
        panel_busqueda = new javax.swing.JPanel();
        campo_busqueda = new javax.swing.JTextField();
        filler1 = new javax.swing.Box.Filler(new java.awt.Dimension(5, 0), new java.awt.Dimension(5, 0), new java.awt.Dimension(5, 32767));
        boton_busqueda = new javax.swing.JButton();
        boton_limpiar = new javax.swing.JButton();
        filler3 = new javax.swing.Box.Filler(new java.awt.Dimension(50, 0), new java.awt.Dimension(50, 0), new java.awt.Dimension(50, 32767));
        radial_persona = new javax.swing.JRadioButton();
        radial_libro = new javax.swing.JRadioButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        tabla_alquileres = new javax.swing.JTable();

        popMenu_devolucion.setText("Devolver");
        popMenu_devolucion.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                popMenu_devolucionActionPerformed(evt);
            }
        });
        pop_alquileres.add(popMenu_devolucion);

        popMenu_verLibro.setText("Datos del libro...");
        popMenu_verLibro.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                popMenu_verLibroActionPerformed(evt);
            }
        });
        pop_alquileres.add(popMenu_verLibro);

        popMenu_verUsuario.setText("Datos del usuario...");
        popMenu_verUsuario.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                popMenu_verUsuarioActionPerformed(evt);
            }
        });
        pop_alquileres.add(popMenu_verUsuario);

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Lista de alquileres");
        setPreferredSize(new java.awt.Dimension(800, 400));
        addComponentListener(new java.awt.event.ComponentAdapter() {
            public void componentShown(java.awt.event.ComponentEvent evt) {
                formComponentShown(evt);
            }
        });
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosed(java.awt.event.WindowEvent evt) {
                formWindowClosed(evt);
            }
        });
        getContentPane().setLayout(new javax.swing.BoxLayout(getContentPane(), javax.swing.BoxLayout.PAGE_AXIS));

        panel_busqueda.setBorder(javax.swing.BorderFactory.createEmptyBorder(5, 10, 0, 10));
        panel_busqueda.setMaximumSize(new java.awt.Dimension(2147483647, 32));
        panel_busqueda.setLayout(new javax.swing.BoxLayout(panel_busqueda, javax.swing.BoxLayout.LINE_AXIS));

        campo_busqueda.setText("Introduce tu busqueda...");
        campo_busqueda.setToolTipText("Busca un alquiler por un nombre ");
        campo_busqueda.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                campo_busquedaMouseClicked(evt);
            }
        });
        panel_busqueda.add(campo_busqueda);
        panel_busqueda.add(filler1);

        boton_busqueda.setIcon(new javax.swing.ImageIcon(getClass().getResource("/buscar_pequenio.png"))); // NOI18N
        boton_busqueda.setToolTipText("Buscar");
        boton_busqueda.setBorderPainted(false);
        boton_busqueda.setContentAreaFilled(false);
        boton_busqueda.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        boton_busqueda.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                boton_busquedamouseEncima(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                boton_busquedamouseFuera(evt);
            }
        });
        boton_busqueda.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                boton_busquedaActionPerformed(evt);
            }
        });
        panel_busqueda.add(boton_busqueda);

        boton_limpiar.setIcon(new javax.swing.ImageIcon(getClass().getResource("/limpiar_pequenio.png"))); // NOI18N
        boton_limpiar.setToolTipText("Limpiar");
        boton_limpiar.setBorderPainted(false);
        boton_limpiar.setContentAreaFilled(false);
        boton_limpiar.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseEntered(java.awt.event.MouseEvent evt) {
                boton_limpiarmouseEncima(evt);
            }
            public void mouseExited(java.awt.event.MouseEvent evt) {
                boton_limpiarmouseFuera(evt);
            }
        });
        boton_limpiar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                boton_limpiarActionPerformed(evt);
            }
        });
        panel_busqueda.add(boton_limpiar);
        panel_busqueda.add(filler3);

        grupo_buscador.add(radial_persona);
        radial_persona.setSelected(true);
        radial_persona.setText("Buscar personas");
        panel_busqueda.add(radial_persona);

        grupo_buscador.add(radial_libro);
        radial_libro.setText("Buscar libros");
        panel_busqueda.add(radial_libro);

        getContentPane().add(panel_busqueda);

        jScrollPane1.setBorder(javax.swing.BorderFactory.createCompoundBorder(javax.swing.BorderFactory.createEmptyBorder(10, 10, 10, 10), javax.swing.BorderFactory.createTitledBorder("")));

        tabla_alquileres.setAutoCreateRowSorter(true);
        tabla_alquileres.setModel(modelo_tabla);
        tabla_alquileres.setComponentPopupMenu(pop_alquileres);
        tabla_alquileres.getTableHeader().setReorderingAllowed(false);
        tabla_alquileres.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mousePressed(java.awt.event.MouseEvent evt) {
                tabla_alquileresMousePressed(evt);
            }
        });
        jScrollPane1.setViewportView(tabla_alquileres);

        getContentPane().add(jScrollPane1);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void formComponentShown(java.awt.event.ComponentEvent evt) {//GEN-FIRST:event_formComponentShown
        setLocationRelativeTo(vista_padre);
    }//GEN-LAST:event_formComponentShown

    private void campo_busquedaMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_campo_busquedaMouseClicked
        JTextField campo = (JTextField) evt.getSource();
        campo.setText("");
    }//GEN-LAST:event_campo_busquedaMouseClicked

    private void boton_busquedamouseEncima(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_boton_busquedamouseEncima
        JButton boton = (JButton) evt.getSource();
        boton.setContentAreaFilled(true);
    }//GEN-LAST:event_boton_busquedamouseEncima

    private void boton_busquedamouseFuera(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_boton_busquedamouseFuera
        JButton boton = (JButton) evt.getSource();
        boton.setContentAreaFilled(false);
    }//GEN-LAST:event_boton_busquedamouseFuera

    private void boton_busquedaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_boton_busquedaActionPerformed

        String texto = campo_busqueda.getText();
        ArrayList<Alquiler> alquileres_encontrados = vista_padre.buscaAlquileres(texto, radial_libro.isSelected());

        if (alquileres_encontrados.isEmpty()) {
            JOptionPane.showMessageDialog(this, "Sin resultados",
                    "Busqueda de alquileres", JOptionPane.INFORMATION_MESSAGE);
        } else {
            modelo_busqueda.addAlquileres(alquileres_encontrados);
            tabla_alquileres.setModel(modelo_busqueda);
            boton_busqueda.setVisible(false);
            boton_limpiar.setVisible(true);
            pack();

        }

    }//GEN-LAST:event_boton_busquedaActionPerformed

    private void boton_limpiarmouseEncima(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_boton_limpiarmouseEncima
        JButton boton = (JButton) evt.getSource();
        boton.setContentAreaFilled(true);
    }//GEN-LAST:event_boton_limpiarmouseEncima

    private void boton_limpiarmouseFuera(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_boton_limpiarmouseFuera
        JButton boton = (JButton) evt.getSource();
        boton.setContentAreaFilled(false);
    }//GEN-LAST:event_boton_limpiarmouseFuera

    private void boton_limpiarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_boton_limpiarActionPerformed
        boton_limpiar.setVisible(false);
        boton_busqueda.setVisible(true);
        campo_busqueda.setText("Introduce tu busqueda...");
        tabla_alquileres.setModel(modelo_tabla);
        pack();
    }//GEN-LAST:event_boton_limpiarActionPerformed

    private void tabla_alquileresMousePressed(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tabla_alquileresMousePressed
        int fila_actual = tabla_alquileres.rowAtPoint(evt.getPoint());
        tabla_alquileres.setRowSelectionInterval(fila_actual, fila_actual);
    }//GEN-LAST:event_tabla_alquileresMousePressed

    private void popMenu_verLibroActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_popMenu_verLibroActionPerformed
        int fila = tabla_alquileres.getSelectedRow();
        ModeloAlquiler modelo = (ModeloAlquiler) tabla_alquileres.getModel();
        Alquiler alquiler_seleccionado = modelo.getAlquiler(fila);

        vista_padre.abreDialogoVerLibros(alquiler_seleccionado.getLibro());
    }//GEN-LAST:event_popMenu_verLibroActionPerformed

    private void popMenu_verUsuarioActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_popMenu_verUsuarioActionPerformed
        int fila = tabla_alquileres.getSelectedRow();
        ModeloAlquiler modelo = (ModeloAlquiler) tabla_alquileres.getModel();
        Alquiler alquiler_seleccionado = modelo.getAlquiler(fila);

        vista_padre.abreDialogoVerUsuarios(alquiler_seleccionado.getPersona());
    }//GEN-LAST:event_popMenu_verUsuarioActionPerformed

    private void formWindowClosed(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed

    }//GEN-LAST:event_formWindowClosed

    private void popMenu_devolucionActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_popMenu_devolucionActionPerformed
        int fila = tabla_alquileres.getSelectedRow();
        ModeloAlquiler modelo = (ModeloAlquiler) tabla_alquileres.getModel();
        Alquiler alquiler_seleccionado = modelo.getAlquiler(fila);

        vista_padre.realizaDevolucion(alquiler_seleccionado);
    }//GEN-LAST:event_popMenu_devolucionActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton boton_busqueda;
    private javax.swing.JButton boton_limpiar;
    private javax.swing.JTextField campo_busqueda;
    private javax.swing.Box.Filler filler1;
    private javax.swing.Box.Filler filler3;
    private javax.swing.ButtonGroup grupo_buscador;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JPanel panel_busqueda;
    private javax.swing.JMenuItem popMenu_devolucion;
    private javax.swing.JMenuItem popMenu_verLibro;
    private javax.swing.JMenuItem popMenu_verUsuario;
    private javax.swing.JPopupMenu pop_alquileres;
    private javax.swing.JRadioButton radial_libro;
    private javax.swing.JRadioButton radial_persona;
    private javax.swing.JTable tabla_alquileres;
    // End of variables declaration//GEN-END:variables
}
